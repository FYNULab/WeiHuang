C51 COMPILER V7.06   MAIN                                                                  07/28/2012 09:28:31 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          /***************************************************************************************************    
   2          工程名称：      NTC_SMG
   3          功能描述：  实现NTC热敏电阻测温，数码管低三位显示结果，其中显示的最高位为符号位(测温范围-10-50)。
   4          硬件连接：  用8位杜邦线将J8与J12连接，2位杜邦线分别将J11_0与J15_DS1、J11_1与J15_DS2连接,
   5                      1位杜邦线将J19_AIN0与J15_RT连接,2位杜邦线分别将J11_7与J17_SDA、J11_6与J17_SCL连接。
   6          维护记录：  2011-8-22
   7          ***************************************************************************************************/
   8          #include "reg51.h"          //包含头文件
   9          #define uchar unsigned char
  10          #define uint  unsigned int
  11          
  12          sbit LE1=P2^0;           //位选573锁存器使能
  13          sbit LE2=P2^1;           //段选573锁存器使能
  14          
  15          extern uchar Read_AD(uchar chn);
  16          extern show();
  17          
  18          
  19          uchar flag;        //正负符号位
  20          
  21          
  22          uchar code dis[16]={0x3F,0x06,0x5B,0x4F,0x66,0x6D,0x7D,0x07,
  23                             //  0    1    2    3    4    5    6    7    
  24                               0x7F,0x6F,0x77,0x7C,0x39,0x5E,0x79,0x71};//0~F的段码
  25                             //  8    9    A    B    C    D    E    F  
  26          
  27          code unsigned int  vt_table[]=  //电压与实际温度对照表
  28                  {
  29                          4132,4098,4063,4026,3988,3949,3908,3866,3823,3779, //-9-0
  30                          3733,3686,3639,3590,3540,3489,3437,3385,3331,3277, //1-10
  31                          3222,3166,3110,3054,2997,2940,2882,2824,2767,2709, //11-20
  32                          2651,2593,2536,2478,2421,2365,2309,2253,2198,2143, //21-30
  33                          2089,2036,1984,1932,1881,1831,1782,1734,1686,1640, //31-40
  34                          1594,1550,1506,1464,1422,1381,1341,1303,1265,1228, //41-50
  35                  };
  36          //**************************************************************************************************
  37          //延时函数
  38          //**************************************************************************************************
  39          delay(uint time)         //int型数据为16位,所以最大值为65535            
  40           {
  41   1        uint  i,j;             //定义变量i,j,用于循环语句 
  42   1        for(i=0;i<time;i++)    //for循环,循环50*time次
  43   1           for(j=0;j<100;j++); //for循环,循环50次
  44   1       }
  45          //**************************************************************************************************
  46          //数码管显示函数
  47          //**************************************************************************************************
  48          smg_show(uchar n)
  49          { 
  50   1            //显示符号位
  51   1           P1=0xdf;                 //0xbf=1101 1111,即选通个位
  52   1           LE1=1;                   //锁存位
  53   1           LE1=0;                   //断开锁存,位选573的Q7~Q0仍保持 
  54   1           if(flag){P1=0x40;flag=0;}//为负，显示"-"号
  55   1             else  P1=0x00;         //为正，不显示
C51 COMPILER V7.06   MAIN                                                                  07/28/2012 09:28:31 PAGE 2   

  56   1           LE2=1;                   //锁存段码
  57   1           LE2=0;                   //断开锁存,段选573的Q7~Q0仍保持
  58   1           delay(10);               //延时保持一下,延时过大会闪动，延时过小会有重影    
  59   1      
  60   1           P1=0x00;LE2=1;LE2=0;     //清除P1口数据，以免造重影
  61   1            //显示十位
  62   1           P1=0xbf;                 //0xbf=1011 1111,即选通个位
  63   1           LE1=1;                   //锁存位
  64   1           LE1=0;                   //断开锁存,位选573的Q7~Q0仍保持 
  65   1           P1=dis[n/10];            //dis[n/10]为0~9的编码
  66   1           LE2=1;                   //锁存段码
  67   1           LE2=0;                   //断开锁存,段选573的Q7~Q0仍保持
  68   1           delay(10);               //延时保持一下,延时过大会闪动，延时过小会有重影    
  69   1      
  70   1           P1=0x00;LE2=1;LE2=0;     //清除P1口数据，以免造重影
  71   1           //显示个位
  72   1           P1=0x7f;                 //0xbf=0111 1111,即选通十分位
  73   1           LE1=1;                   //锁存位
  74   1           LE1=0;                   //断开锁存,位选573的Q7~Q0仍保持 
  75   1           P1=dis[n%10];            //0~9的编码
  76   1           LE2=1;                   //锁存段码
  77   1           LE2=0;                   //断开锁存,段选573的Q7~Q0仍保持 
  78   1           delay(10);               //延时保持一下,延时过大会闪动，延时过小会有重影  
  79   1      
  80   1           P1=0x00;LE2=1;LE2=0;     //清除P1口数据，以免造重影   
  81   1                
  82   1      }
  83          //**************************************************************************************************
  84          //主函数
  85          //**************************************************************************************************
  86          void main()
  87          {       
  88   1         uchar i,value; 
  89   1         uint temp;
  90   1         while(1)                         //死循环
  91   1          {
  92   2             temp=Read_AD(0);             //采集0通道模拟电压值
  93   2             temp=19*temp;                //乘以电阻特性参数
  94   2             for(i=0;(vt_table[i]>temp)&&(i<60);i++);//查表得到温度对应参数
  95   2             if(i<10) {value=10-i;flag=1;}//如果是负温度，符号标志置1，表示为负
  96   2                  else value=i-10;        //如果为正，去掉10个负数
  97   2             smg_show(value);             //显示温度值
  98   2      
  99   2              }
 100   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    208    ----
   CONSTANT SIZE    =    136    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
