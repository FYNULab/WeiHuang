C51 COMPILER V7.06   MAIN                                                                  10/17/2014 21:09:43 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          //公司：北方蓝芯科技开发有限公司
   2          //网址：www.hrbnbc.com
   3          //更多教程可登陆技术论坛www.hrbnbc.com/bbs对应版块下载，
   4          //所有教程一律免费下载
   5          /***************************************************************************************************    
   6          工程名称：      Dcmotor
   7          功能描述：  通过按键S20和S18分别控制直流电机速度加与减,数码管显示速度等级
   8          硬件连接：  用8位杜邦线将J10与J12连接，用2位杜邦线分别将J11_0与J15_DS1及J11_1与J15_DS2连接，
   9                      用1位杜邦线将J8_0与J18_DCMT连接，用1位杜邦线将J9_7与J7_S18连接，
  10                      用1位杜邦线将J9_6与J7_S20连接，将直流电机连接到JP7接口
  11          维护记录：  2011-8-22
  12          ***************************************************************************************************/
  13          #include "reg51.h"       //包含头文件
  14          
  15          sbit S20=P3^6;           //定义S20控制IO，电机转速加大
  16          sbit S18=P3^7;           //定义S18控制IO，电机转速减小
  17          sbit Dcout=P1^0;         //定义电机控制IO
  18          sbit LE1=P2^0;           //位选573锁存器使能
  19          sbit LE2=P2^1;           //段选573锁存器使能
  20          
  21          #define uchar unsigned char
  22          #define uint  unsigned int
  23           
  24          uchar num;               //记录定时中断次数
  25          uchar speed;             //电机转速
  26          
  27          
  28          
  29          uchar code dis[16]={0x3F,0x06,0x5B,0x4F,0x66,0x6D,0x7D,0x07,
  30                             //  0    1    2    3    4    5    6    7    
  31                               0x7F,0x6F,0x77,0x7C,0x39,0x5E,0x79,0x71};//0~F的段码
  32                             //  8    9    A    B    C    D    E    F  
  33          //**************************************************************************************************
  34          //延时函数
  35          //**************************************************************************************************
  36          delay(uint time)         //int型数据为16位,所以最大值为65535            
  37           {
  38   1        uint  i,j;             //定义变量i,j,用于循环语句 
  39   1        for(i=0;i<time;i++)    //for循环,循环50*time次
  40   1           for(j=0;j<50;j++);  //for循环,循环50次
  41   1       }
  42          //**************************************************************************************************
  43          //定时器中断子程序
  44          //**************************************************************************************************
  45          t0() interrupt 1 using 1
  46          {
  47   1        TH0=0xfc;               //重置定时器初值,定时1ms
  48   1        TL0=0x18;
  49   1         if(num==speed)Dcout=0; //如果进入中断speed次时，Dcout置低，占空比=speed/20,speed越大,则转速越快
  50   1        num++;                  //次数加1
  51   1         if(num==20)            //满20次为一周期，即T=20次*1ms=20ms
  52   1          {
  53   2           num=0;               //重置num为0,开始下一周期
  54   2           Dcout=1;             //Dcout置高
  55   2          }
C51 COMPILER V7.06   MAIN                                                                  10/17/2014 21:09:43 PAGE 2   

  56   1      }
  57          //**************************************************************************************************
  58          //定时器初始化
  59          //**************************************************************************************************
  60          T0_init()
  61          {
  62   1         TMOD=0x01;    //0b00000001  用的是定时器0，工作在方式1（16位寄存器）
  63   1                       //要实现定时1ms,(65536-T0)x12/12000000=0.001s得T0=15536即0xfc18
  64   1         TH0=0xfc;     //装定时器初值高8位
  65   1         TL0=0x18;     //装定时器初值低8位
  66   1         TR0=1;        //启动定时器0
  67   1         ET0=1;        //开定时器0中断
  68   1         EA=1;         //开总中断
  69   1      }
  70          //**************************************************************************************************
  71          //数码管显示函数
  72          //**************************************************************************************************
  73          smg_show(uchar n)
  74          {
  75   1        uchar i;
  76   1        for(i=0;i<10;i++)
  77   1         {
  78   2            //显示个位
  79   2           P0=0xbf;                 //0xbf=1011 1111,即选通个位
  80   2           LE1=1;                   //锁存位
  81   2           LE1=0;                   //断开锁存,位选573的Q7~Q0仍保持 
  82   2           P0=dis[n/10];            //dis[n/10]为0~9的编码
  83   2           LE2=1;                   //锁存段码
  84   2           LE2=0;                   //断开锁存,段选573的Q7~Q0仍保持
  85   2           delay(100);              //延时保持一下,延时过大会闪动，延时过小会有重影    
  86   2      
  87   2           P0=0x00;LE2=1;LE2=0;     //清除P1口数据，以免造重影
  88   2           //显示十分位
  89   2           P0=0x7f;                 //0xbf=0111 1111,即选通十分位
  90   2           LE1=1;                   //锁存位
  91   2           LE1=0;                   //断开锁存,位选573的Q7~Q0仍保持 
  92   2           P0=dis[n%10];            //0~9的编码
  93   2           LE2=1;                   //锁存段码
  94   2           LE2=0;                   //断开锁存,段选573的Q7~Q0仍保持 
  95   2           delay(100);              //延时保持一下,延时过大会闪动，延时过小会有重影  
  96   2      
  97   2           P0=0x00;LE2=1;LE2=0;     //清除P1口数据，以免造重影   
  98   2         }             
  99   1      }
 100          
 101          //**************************************************************************************************
 102          //主函数
 103          //**************************************************************************************************
 104          main()
 105          {
 106   1         T0_init();
 107   1         speed=10;                                  //初始化转速，占空比=speed/20=1/2
 108   1         while(1)                                   //死循环，等待定时器中断
 109   1           {
 110   2             if(S20==0)                             //按键扫描，判断加速键是否按下
 111   2               {   
 112   3                 delay(20);                         //延时消抖
 113   3                 while(S20==0);       //等待按键释放,按一次只能加1，屏蔽此句时，按下按键不松时，会不断递增
 114   3                 if(speed<20)speed++;else speed=0;  //转速加1
 115   3               }
 116   2             
 117   2             if(S18==0)                             //按键扫描，判断减速键是否按下
C51 COMPILER V7.06   MAIN                                                                  10/17/2014 21:09:43 PAGE 3   

 118   2               {   
 119   3                 delay(20);                         //延时消抖
 120   3                 while(S18==0);     //等待按键释放,按一次只能减1，屏蔽此句时，按下按键不松时，会不断递减
 121   3                 if(speed>0)speed--;else speed=20;  //转速减1 
 122   3               }           
 123   2          smg_show(speed);                          //数码管最低两位显示转速
 124   2           } 
 125   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    229    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
