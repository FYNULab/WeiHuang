C51 COMPILER V7.06   MAIN                                                                  07/28/2012 10:27:17 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          /***************************************************************************************************    
   2          ¹¤³ÌÃû³Æ£º      stepmotor
   3          ¹¦ÄÜÃèÊö£º  S17-Õý×ª¡¢S18-×ªËÙÖµ¼õ1¡¢S19-Æô¶¯/ÔÝÍ£¡¢S20-×ªËÙÖµ¼Ó1¡¢S21-·´×ª£¬ÊýÂë¹ÜÏÔÊ¾ËÙ¶ÈµÈ¼¶
   4          Ó²¼þÁ¬½Ó£º  ÓÃ8Î»¶Å°îÏß½«J8ÓëJ12Á¬½Ó£¬ÓÃ2Î»¶Å°îÏß·Ö±ð½«J11_6ÓëJ15_DS1¼°J11_7ÓëJ15_DS2Á¬½Ó£¬
   5                      ÓÃ4Î»¶Å°îÏßÁ¬½ÓJ11_0£¬J11_1£¬J11_2£¬J11_3ºÍJ18_A,J18_B,J18_C,J18_D,½«²½½øµç»úÁ¬½Óµ½JP8
   6                      ÓÃ5Î»¶Å°îÏß½«J9_7ÓëJ7_s17¡¢J9_6ÓëJ7_s18¡¢J9_5ÓëJ7_s19¡¢J9_4ÓëJ7_s20¡¢J9_3ÓëJ7_s21¡£
   7          Î¬»¤¼ÇÂ¼£º  2011-8-22
   8          ***************************************************************************************************/
   9          #include "reg51.h"       //°üº¬Í·ÎÄ¼þ
  10          
  11          sbit S_A=P2^0;           //¶¨Òå²½½øµç»úAÏà
  12          sbit S_B=P2^1;           //¶¨Òå²½½øµç»úBÏà
  13          sbit S_C=P2^2;           //¶¨Òå²½½øµç»úCÏà
  14          sbit S_D=P2^3;           //¶¨Òå²½½øµç»úDÏà
  15          
  16          sbit S17=P3^7;           //Õý´«
  17          sbit S18=P3^6;           //¶¨ÒåS18¿ØÖÆIO£¬µç»ú×ªËÙ¼õÐ¡
  18          sbit S19=P3^5;           //Æô¶¯/ÔÝÍ£
  19          sbit S20=P3^4;           //¶¨ÒåS20¿ØÖÆIO£¬µç»ú×ªËÙ¼Ó´ó
  20          sbit S21=P3^3;           //·´×ª
  21          
  22          sbit LE1=P2^6;           //Î»Ñ¡573Ëø´æÆ÷Ê¹ÄÜ
  23          sbit LE2=P2^7;           //¶ÎÑ¡573Ëø´æÆ÷Ê¹ÄÜ
  24          
  25          bit zf,stop;
  26          
  27          #define uchar unsigned char
  28          #define uint  unsigned int
  29           
  30          uint  speed;             //µç»ú×ªËÙ
  31          
  32          uchar keyValue;          //¶¨Òå¼üÅÌÉ¨Ãè½á¹û²ÎÊý
  33          uchar code dis[16]={0x3F,0x06,0x5B,0x4F,0x66,0x6D,0x7D,0x07,
  34                             //  0    1    2    3    4    5    6    7    
  35                               0x7F,0x6F,0x77,0x7C,0x39,0x5E,0x79,0x71};//0~FµÄ¶ÎÂë
  36                             //  8    9    A    B    C    D    E    F  
  37          
  38          //**************************************************************************************************
  39          //ÑÓÊ±º¯Êý
  40          //**************************************************************************************************
  41          delay(uint time)         //intÐÍÊý¾ÝÎª16Î»,ËùÒÔ×î´óÖµÎª65535            
  42           {
  43   1        uint  i,j;             //¶¨Òå±äÁ¿i,j,ÓÃÓÚÑ­»·Óï¾ä 
  44   1        for(i=0;i<time;i++)    //forÑ­»·,Ñ­»·50*time´Î
  45   1           for(j=0;j<50;j++);  //forÑ­»·,Ñ­»·50´Î
  46   1       }
  47          
  48          //**************************************************************************************************
  49          //ÊýÂë¹ÜÏÔÊ¾º¯Êý
  50          //**************************************************************************************************
  51          smg_show(uchar n)
  52          { 
  53   1            //ÏÔÊ¾¸öÎ»
  54   1           P1=0xbf;                 //0xbf=1011 1111,¼´Ñ¡Í¨¸öÎ»
  55   1           LE1=1;                   //Ëø´æÎ»
C51 COMPILER V7.06   MAIN                                                                  07/28/2012 10:27:17 PAGE 2   

  56   1           LE1=0;                   //¶Ï¿ªËø´æ,Î»Ñ¡573µÄQ7~Q0ÈÔ±£³Ö 
  57   1           P1=dis[n/10];            //dis[n/10]Îª0~9µÄ±àÂë
  58   1           LE2=1;                   //Ëø´æ¶ÎÂë
  59   1           LE2=0;                   //¶Ï¿ªËø´æ,¶ÎÑ¡573µÄQ7~Q0ÈÔ±£³Ö
  60   1           delay(10);              //ÑÓÊ±±£³ÖÒ»ÏÂ,ÑÓÊ±¹ý´ó»áÉÁ¶¯£¬ÑÓÊ±¹ýÐ¡»áÓÐÖØÓ°    
  61   1      
  62   1           P1=0x00;LE2=1;LE2=0;     //Çå³ýP1¿ÚÊý¾Ý£¬ÒÔÃâÔìÖØÓ°
  63   1           //ÏÔÊ¾Ê®·ÖÎ»
  64   1           P1=0x7f;                 //0xbf=0111 1111,¼´Ñ¡Í¨Ê®·ÖÎ»
  65   1           LE1=1;                   //Ëø´æÎ»
  66   1           LE1=0;                   //¶Ï¿ªËø´æ,Î»Ñ¡573µÄQ7~Q0ÈÔ±£³Ö 
  67   1           P1=dis[n%10];            //0~9µÄ±àÂë
  68   1           LE2=1;                   //Ëø´æ¶ÎÂë
  69   1           LE2=0;                   //¶Ï¿ªËø´æ,¶ÎÑ¡573µÄQ7~Q0ÈÔ±£³Ö 
  70   1           delay(10);              //ÑÓÊ±±£³ÖÒ»ÏÂ,ÑÓÊ±¹ý´ó»áÉÁ¶¯£¬ÑÓÊ±¹ýÐ¡»áÓÐÖØÓ°  
  71   1      
  72   1           P1=0x00;LE2=1;LE2=0;     //Çå³ýP1¿ÚÊý¾Ý£¬ÒÔÃâÔìÖØÓ°   
  73   1                
  74   1      }
  75          //**************************************************************************************************
  76          //1*5°´¼üÉ¨Ãèº¯Êý
  77          //**************************************************************************************************
  78          keyScan()                             
  79           {
  80   1         P3=P3|0xf8;                //P3¸ß5Î»ÖÃ1£¬ÉèÖÃÎªÊäÈë 
  81   1         if((P3&0xf8)!=0xf8)        //ÅÐ¶ÏÊÇ·ñÓÐ°´¼ü°´ÏÂ
  82   1          {
  83   2           delay(20);               //ÑÓÊ±Ð¤¶¶
  84   2           if((P3&0xf8)!=0xf8)      //ÔÙ´ÎÅÐ¶ÏÊÇ·ñÓÐ°´¼ü°´ÏÂ
  85   2             keyValue=(P3&0xf8);    //¶ÁÈ¡É¨Ãè½á¹û
  86   2             while((P3&0xf8)!=0xf8);
  87   2          }
  88   1       }
  89          //**************************************************************************************************
  90          //1*5°´¼üÉ¨Ãè½á¹û´¦Àíº¯Êý
  91          //**************************************************************************************************
  92          keyHandle()                     
  93           {      
  94   1              switch(keyValue)         
  95   1                {
  96   2                  case 0x78:               //Èç¹ûS17°´¼ü°´ÏÂ  
  97   2                                      {
  98   3                       zf=1;               //Õý·´±êÖ¾ÖÃ1£¬ÕýÏò
  99   3                       break;          
 100   3                      }
 101   2                  case 0xb8:               //Èç¹ûS18°´¼ü°´ÏÂ 
 102   2                                      {
 103   3                       if(speed>15)speed--;//¼õËÙ 
 104   3                         else speed=30;    
 105   3                       break;
 106   3                      }
 107   2                  case 0xd8:               //Èç¹ûS19°´¼ü°´ÏÂ 
 108   2                                      {
 109   3                       stop=~stop;         //Æô¶¯/ÔÝÍ£  
 110   3                       break;
 111   3                      }
 112   2                  case 0xe8:               //Èç¹ûS20°´¼ü°´ÏÂ 
 113   2                                      {                 
 114   3                       if(speed<45)speed++;//¼õËÙ 
 115   3                         else speed=30;  
 116   3                       break;
 117   3                      }
C51 COMPILER V7.06   MAIN                                                                  07/28/2012 10:27:17 PAGE 3   

 118   2                  case 0xf0:               //Èç¹ûS21°´¼ü°´ÏÂ 
 119   2                                      {
 120   3                       zf=0;               //Õý·´±êÖ¾ÖÃ0£¬·´Ïò              
 121   3                       break;
 122   3                      }
 123   2                  default:
 124   2                                              break;
 125   2                }
 126   1       }
 127          //**************************************************************************************************
 128          //²½½øµç»ú¿ØÖÆ
 129          //**************************************************************************************************
 130          stepmotor()
 131          {     
 132   1           if(stop==0)           //Í£Ö¹±êÖ¾Î»Îª0£¬Ö´ÐÐÒÔÏÂ³ÌÐò£¬Èç¹ûÎª1£¬²»Ö´ÐÐÒÔÏÂ³ÌÐò
 133   1             {
 134   2                 if(zf)          //zf£¬¼´Õý·´±êÖ¾Îª1£¬ÕýÏò×ª¶¯
 135   2                  { 
 136   3                   P2=0x01;      //µÈÐ§ÓÚS_D=0,S_C=0,S_B=0,S_A=1
 137   3                   delay(speed); //ÑÓÊ±£¬ÐÞ¸Ä´Ë²ÎÊý¼´¿ÉÐÞ¸Äµç»ú×ªËÙ
 138   3                   P2=0x03;      //µÈÐ§ÓÚS_D=0,S_C=0,S_B=1,S_A=1
 139   3                   delay(speed); 
 140   3                   P2=0x02;      //iµÈÐ§ÓÚS_D=0,S_C=0,S_B=1,S_A=0
 141   3                   delay(speed); 
 142   3                   P2=0x06;      //µÈÐ§ÓÚS_D=0,S_C=1,S_B=1,S_A=0
 143   3                   delay(speed); 
 144   3                   P2=0x04;      //µÈÐ§ÓÚS_D=0,S_C=1,S_B=0,S_A=0
 145   3                   delay(speed); 
 146   3                   P2=0x0c;      //µÈÐ§ÓÚS_D=1,S_C=1,S_B=0,S_A=0
 147   3                   delay(speed); 
 148   3                   P2=0x08;      //µÈÐ§ÓÚS_D=1,S_C=0,S_B=0,S_A=0
 149   3                   delay(speed); 
 150   3                   P2=0x09;      //µÈÐ§ÓÚS_D=1,S_C=0,S_B=0,S_A=1
 151   3                   delay(speed); 
 152   3                  }
 153   2                 else            //zf£¬¼´Õý·´±êÖ¾Îª0£¬·´Ïò×ª¶¯¬    
 154   2                  { 
 155   3                   P2=0x09;      //µÈÐ§ÓÚS_D=1,S_C=0,S_B=0,S_A=1
 156   3                   delay(speed); //ÑÓÊ±£¬ÐÞ¸Ä´Ë²ÎÊý¼´¿ÉÐÞ¸Äµç»ú×ªËÙ
 157   3                   P2=0x08;      //µÈÐ§ÓÚS_D=1,S_C=0,S_B=0,S_A=0
 158   3                   delay(speed); 
 159   3                   P2=0x0c;      //µÈÐ§ÓÚS_D=1,S_C=1,S_B=0,S_A=0
 160   3                   delay(speed);  
 161   3                   P2=0x04;      //µÈÐ§ÓÚS_D=0,S_C=1,S_B=0,S_A=0
 162   3                   delay(speed);
 163   3                   P2=0x06;      //µÈÐ§ÓÚS_D=0,S_C=1,S_B=1,S_A=0
 164   3                   delay(speed);        
 165   3                   P2=0x02;      //iµÈÐ§ÓÚS_D=0,S_C=0,S_B=1,S_A=0
 166   3                   delay(speed);
 167   3                   P2=0x03;      //µÈÐ§ÓÚS_D=0,S_C=0,S_B=1,S_A=1
 168   3                   delay(speed);       
 169   3                   P2=0x01;      //µÈÐ§ÓÚS_D=0,S_C=0,S_B=0,S_A=1
 170   3                   delay(speed); 
 171   3                  }           
 172   2             }         
 173   1      }
 174          //**************************************************************************************************
 175          //Ö÷º¯Êý
 176          //**************************************************************************************************
 177          main()
 178          {
 179   1        speed=30;                      //³õÊ¼»¯×ªËÙ
C51 COMPILER V7.06   MAIN                                                                  07/28/2012 10:27:17 PAGE 4   

 180   1         while(1)                      //ËÀÑ­»·£¬µÈ´ý¶¨Ê±Æ÷ÖÐ¶Ï
 181   1           {   keyValue=0;             //³õÊ¼»¯¼üÖµÎª0
 182   2               keyScan();              //°´¼üÉ¨Ãè
 183   2               keyHandle();            //´¦ÀíÉ¨Ãè½á¹û
 184   2               stepmotor();            //µç»ú×ª¶¯
 185   2               smg_show(speed);        //ÊýÂë¹Ü×îµÍÁ½Î»ÏÔÊ¾×ªËÙ,³õÊ¼»¯Îª30£¬ÖµÔ½´ó£¬×ªËÙÔ½Ð¡
 186   2           } 
 187   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    352    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
